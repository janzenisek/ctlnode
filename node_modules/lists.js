var mongo = require('mongoskin');
var moment = require('moment');
var db = mongo.db('mongo://localhost/ctlnode?auto_reconnect=true');
db.bind('lists');
db.lists.ensureIndex({ alias: 1 });

var store = {
    findOne: function(alias, callback) {
        db.lists.findOne({ alias: alias }, callback);
    },
    create: function(alias, callback) {
        db.lists.insert({ alias: alias, creationMoment: moment().format('L'), tasks: []}, callback);
    },
    update: function(list) {
        db.lists.update({ alias: list.alias }, { $set: { data: list.data } }, function (err, result) {
            if (!err) console.log('list updated!');
        });
    },
    delete: function(alias) {
        db.lists.remove({ alias: alias });
    }
};

module.exports = store;
