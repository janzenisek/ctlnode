// require modules
var url = require('url');

// set up a module handler object
var redirect = function (domain) {
    return function (req, res, next) {
        // if analyzed hostheader is equal to localhost (used during development)
        // or the forwarded 'main' domain...
        var hostHeader = req.headers.host || '';
        if (hostHeader.indexOf('localhost') === 0 || hostHeader.indexOf(domain) === 0) {
            // ...move to next middleware module or back
            if (next) next();
            return;
        }
        // otherwise filter out options (suburl) and redirect to 'main' domain + options
        var options = url.parse(req.url);
        options.host = domain;
        res.writeHead(301, {
            'Location': url.format(options)
        });
        res.end();
    };
};
module.exports = redirect;